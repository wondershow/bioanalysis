<html>
  <head>
	<link rel="stylesheet" type="text/css" href="css/bio.css">
	<link rel="stylesheet" href="css/d3.slider.css"> 
	
	 <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>-->
	<script type="text/javascript" src="js/gsu.util.js"></script>
	<script type="text/javascript" src="js/biodataobj.js"></script>
	<script type="text/javascript" src="js/parseobject.js"></script>
	<script type="text/javascript" src="js/htmltablobj.js"></script>
	<script type="text/javascript" src="js/popupdialog.js"></script>
	<script type="text/javascript" src="js/popupdialog1.js"></script>
	<script type="text/javascript" src="js/svgcanvas.js"></script>
	<script type="text/javascript" src="js/svgscatterchart.js"></script>
	<script type="text/javascript" src="js/svgheatmap.js"></script>
	<script type="text/javascript" src="js/svgchart.js"></script>
	<script type="text/javascript" src="js/gsu.slider.js"></script>
	<script type="text/javascript" src="js/colormix-2.0.0.js"></script>
	
	<!--<script type='text/javascript' src='js/jquery.js'></script>-->
    <!--<script type="text/javascript" src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>-->
	<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>-->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script type='text/javascript' src='js/jquery.simplemodal.js'></script>
	<script src="js/d3.js"> </script>
	<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <script type="text/javascript">
		var google_spreadsheet_url = "https://spreadsheets.google.com/feeds/list/1VIOL9tepP3CXmdkvdZt8kEws3mNV1ZQPSyqRj25zYCc/od6/public/basic?alt=json";
		var fullData;
		var dataCases;
		var mainCanvas;
		var dataTable;
		$.ajax({
				url:   google_spreadsheet_url,
				type:     "GET",
				dataType: "jsonp",
				success: function(data){
					//console.log("asdf")
					fullData = data;
					dataCases = parseGoglJSonObj(fullData);
					configuratePage();
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
						//console.log(arguments);
						console.log("Status: " + textStatus);
						console.log("Error: " + errorThrown);
						//cleanSendObjArray(curObjIndex);
				},
		});
		
		function configuratePage() {
			addTable();
			var popup = new PopUpDialog("content", dataCases[0].getAllNumericalProps(),dataCases[0].getAllNumeratedProps());
			popup.addPopup();
			setupListner();
			mainCanvas = new SVGCanvas("test",dataTable);
			//testCanvas();
		}
		
		function addTable() {
			var tableData = [];
			var i=0;
			for(i=0;i<dataCases.length;i++) {
				tableData.push(dataCases[i].getAllValues());
			}
			dataTable = new HTMLTable(tableData,dataCases[0].getAllPropNames(),"table_header_div","table_body_div");
			dataTable.addTable();
		}
		
		$(document).ready(function()
		{
			/*
			$("#table_header_div").scroll(function () { 
				$("#table_body_div").scrollTop($("#table_header_div").scrollTop());
				$("#table_body_div").scrollLeft($("#table_header_div").scrollLeft());
			});*/
			$("#table_body_div").scroll(function () { 
				$("#table_header_div").scrollTop($("#table_body_div").scrollTop());
				$("#table_header_div").scrollLeft($("#table_body_div").scrollLeft());
			});

		});
		
		function setupListner() {
			jQuery(function ($) {
			// Load dialog on page load
			//$('#basic-modal-content').modal();
			//$('#basic-modal-content').modal();
			// Load dialog on click
			$('#basic-modal .flatbtn').click(function (e) {
				$('#basic-modal-content').modal();
				return false;
				});
			});
		}
		
		function draw() {
			if (document.getElementById("group2_1").checked){
					drawScatter();
					$.modal.close();
			}
			else if (document.getElementById("group2_2").checked) {
					tmp = document.getElementById("x_field");
					x_field = tmp.options[tmp.selectedIndex].value;

					tmp = document.getElementById("y_field");
					y_field = tmp.options[tmp.selectedIndex].value;
					if ( x_field=="" || y_field=="") {
						document.getElementById("alertmsg").innerHTML = "Please select field X, Y";
					} else {
						$.modal.close();
						g_equation_config = new EquationDialog("equation", dataCases[0].getAllNumericalProps(),dataCases[0].getAllNumeratedProps(),x_field,y_field,"g_equation_config");
						g_equation_config.addEquEditor();	
					}
			} else if(document.getElementById("group3_1").checked){
					drawPCG();
			}
		}
		
		function drawHeatmap(params) {
			var x = [];
			var y = [];
			for(i=0;i<dataCases.length;i++) {
					x.push(dataCases[i].getPropVal(params.x_axis));
					y.push(dataCases[i].getPropVal(params.y_axis));
			}
			
			params.x_data = x;
			params.y_data = y;
			params.full_data = dataCases;
			$.modal.close();
			mainCanvas.add(params)
		}
		
		function drawPCG() {
				
		}
		
		/**
			To draw 
		**/
		function drawScatter() {
			var tmp;
			tmp = document.getElementById("x_field");
			x_field = tmp.options[tmp.selectedIndex].value;

			tmp = document.getElementById("y_field");
			y_field = tmp.options[tmp.selectedIndex].value;
			
			tmp = document.getElementById("z_field");
			z_field = tmp.options[tmp.selectedIndex].value;

			tmp = document.getElementById("d_field");
			d_field = tmp.options[tmp.selectedIndex].value;

			if ( x_field=="" || y_field=="") {
				document.getElementById("alertmsg").innerHTML = "Please select field X, Y";
			} else if( x_field == y_field) {
				document.getElementById("alertmsg").innerHTML = "Field X and Y are same";
			} else if( y_field == z_field) {
				document.getElementById("alertmsg").innerHTML = "Field Y and Z are same";
			} else if( x_field == z_field) {
				document.getElementById("alertmsg").innerHTML = "Field X and Z are same";
			} else {
				document.getElementById("alertmsg").innerHTML = "";
				var x = [];
				var y = [];
				var z = [];
				var c = [];
				for(i=0;i<dataCases.length;i++) {
					x.push(dataCases[i].getPropVal(x_field));
					y.push(dataCases[i].getPropVal(y_field));
					if(z_field != undefined && z_field != null && z_field.trim() != "")
						z.push(dataCases[i].getPropVal(z_field));
					if(d_field != undefined && d_field != null && d_field.trim() != "")
						c.push(dataCases[i].getPropVal(d_field));
				}
				var params = {x_data:x,y_data:y,x_axis:x_field,y_axis:y_field,type:"scatter"};
			  
				if(z_field != undefined && z_field != null && z_field.trim() != ""){
					params.z_data = z;
					params.z_axis = z_field;
				} else {
					params.z_data = null;
					params.z_axis = null;
				}
			
				if(d_field != undefined && d_field != null && d_field.trim() != ""){
					params.c_data = c;
					params.c_axis = d_field;
				} else {
					params.c_data = null;
					params.c_axis = null;
				}
				mainCanvas.add(params);
			}
		}
		
		function addDiagram() {
			var x = [];
			var y = [];
			var z = [];
			var c = [];
			var i = 0;
			for(i=0;i<dataCases.length;i++) {
				x.push(dataCases[i].ph3n);
				y.push(dataCases[i].ki67n);
				z.push(dataCases[i].mfin);
				c.push(dataCases[i].racec);
			}
			
			var params = {x_data:x,y_data:y,z_data:z,c_data:c,x_axis:"ph3n",y_axis:"ki67n",z_axis:"mfin",c_axis:"racec",type:"scatter"};
			console.log(params);
			mainCanvas.add(params);
		}
		
		function testCanvas() {
			
			var x = [];
			var y = [];
			var z = [];
			var c = [];
			var i = 0;
			for(i=0;i<dataCases.length;i++) {
				x.push(dataCases[i].ph3n);
				y.push(dataCases[i].ki67n);
				z.push(dataCases[i].mfin);
				c.push(dataCases[i].racec);
			}
			//console.log($(window).width());
			var params = {x_data:x,y_data:y,z_data:z,c_data:c,x_axis:"ph3n",y_axis:"ki67n",z_axis:"mfin",c_axis:"racec",type:"scatter"};
			mainCanvas.add(params);
			//mainCanvas.add(params);
			
			//mainCanvas.add(params);
			
			mainCanvas.add(params);
		}
		
		function handle_table_row_selection(index) {
			mainCanvas.toggle(index);
		}
		
		//var color = ColorMix.blend(69);
		//console.log(color);
		//alert('Your blended color is: rgb(' + color.red + ', ' + color.green + ', ' + color.blue + ')');
    </script>
  </head>
  <body>
	<div id="table_header_div" style="overflow:auto;overflow-x: hidden;">
			
	</div>
	<div id="table_body_div" style="overflow:auto;height:40%;">
			
	</div>
	<div id="content">
	
	</div>
	<div id="equation">
	
	</div>
	
	<svg width='100%' height='1000' id='test' style='background-color:grey'>
		
	</svg>

	
	<svg width='300' height='3000' style='background-color:white' id = "color_test">
		

	</svg>
	
	<svg width='300' height='300' >
		<g transform="translate(10,50)">
			<g transform="translate(0,0)">
				<line x2='5' y2='0'> </line>
				<text dy=".32em" x="9" y="0" style="text-anchor: start;">0</text>
			</g>
			<g transform="translate(0,100)">
				<line x2='5' y2='0'> </line>
				<text dy=".32em" x="9" y="0" style="text-anchor: start;">100</text>
			</g>
			<path class="domain" d="M9,0H1V100H9"></path>
			<rect x="0" y="0" rx="1" ry="1" width="10" height="10"
				style="fill:red;stroke:yellow;stroke-width:1;opacity:1.0"
				onmousedown="" onmouseup = "console.log()" onmousemove=""  
			/>
		</g>
	</svg>
	
	<svg id="testsvg" width = "500" height="500" style='background-color:red'>
		<svg id="testsvg1" x="0" width="200" height="500" style='background-color:blue'>
		</svg>
		<svg id="testsvg2" x="300" width="200" height="500" style='background-color:black'>
		</svg>
	</svg>
	
	<svg xmlns = "http://www.w3.org/2000/svg" width="100%" height="100%">
		<rect x="25" y="25" width="250" height="200" fill="#ff0000" stroke="#000000"/>
			<foreignObject x="50" y="50" width="200" height="150">
				<body xmlns="http://www.w3.org/1999/xhtml">
					<form>
						<input type="text"/>
						<input type="text"/>
					</form>
				</body>
			</foreignObject>
		<circle cx="60" cy="80" r="30" fill="#00ff00" fill-opacity="0.5"/>
	</svg>
	
	<script>
		var i = 0;
		var color = ColorMix.blend(69);
		console.log(d3.select("#color_test"));
		
		var color_hot = new ColorMix.Color('#FF0000');
		var color_cold = new ColorMix.Color('#0000FF');
		
		for(i=0;i<=256;i++) {
			//color1 = ColorMix.blend(i);
			//console.log("color1 : " + color1);
			d3.select("#color_test").append("circle")
				.attr("cx",5)
				.attr("cy",5*i)
				.attr("r",2)
				//.attr("fill",ColorMix.mix([color_hot,color_cold],[ Math.floor(i*100/256),100-Math.floor(i*100/256)]));
				.attr("fill",rgbToHex(i,256-i,256-i));
				
				//.attr("fill","#"+i.toString(16));
			//console.log("#"+i.toString(16));
		}
	</script>
  </body>
</html>